@page
@model SLGIS.Web.Pages.Notify.NewOrEditModel
@{
    ViewBag.Title = (Model.Notify.Id != Guid.Empty ? "Sửa lại" : "Tạo mới") + " thông báo";
    ViewBag.Breadcrumbs = "<a href='" + Url.Page("Index") + "' class='breadcrumb-item'>Thông báo</a>" +
                          "<span class='breadcrumb-item active'>" + ViewBag.Title + "</span>";

}

<form enctype="multipart/form-data" method="post">
    @Html.AntiForgeryToken()

    <div class="card shadow-base mb-2">
        <div class="card-body">
            <div class="row">
                <div class="col-12">
                    <h5 class="text-warning">Lưu ý: Chỉ có thể thu hồi được thông báo trong vòng 24 giờ kể từ khi tạo.</h5>
                    <hr />
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    @Html.HiddenFor(model => model.Notify.Id)
                    <input type="hidden" name="Notify.HydropowerPlantId" value="@ViewData["HydropowerPlantId"]" />
                    <div class="form-group">
                        <label>Tiêu đề</label>
                        @Html.EditorFor(model => model.Notify.Title, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.Notify.Title, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Tài liệu</label>
                        @Html.EditorFor(model => model.Files, new { htmlAttributes = new { @class = "form-control", multiple = "" } })
                    </div>
                    <div class="form-group">
                        <label>Nội dung</label>
                        @Html.TextAreaFor(model => model.Notify.Content, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Notify.Content, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Đối tượng gửi</label>

                        <div>
                            <label class="mr-2">
                                <input type="radio" name="Notify.IsAll" value="true" @(Model.Notify.IsAll ? "checked": "")/>
                                Tất cả các nhà máy thủy điện
                            </label>
                            <label>
                                <input type="radio" name="Notify.IsAll" value="false" @(!Model.Notify.IsAll ? "checked": "")/>
                                Gửi riêng
                            </label>
                        </div>

                        <div>
                            <select name="Notify.ToPlantIds" class="form-control select2" data-placeholder="Chọn nhà máy thủy điện" multiple="multiple" tabindex="-1" aria-hidden="true">
                                @foreach (var item in Model.Plants)
                                {
                                    if (Model.Notify.ToPlantIds.Any(m => m == item.Id))
                                    {
                                        <option value="@item.Id" selected>@item.Name</option>
                                    }
                                    else
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn btn-primary" type="submit">Lưu</button>
    <a href="@Url.Page("Index")" class="btn btn-outline-secondary">Quay lại</a>
</form>
@section Styles {
    <link href="~/lib/summernote/summernote-bs4.css" rel="stylesheet" />
    <style>
        .select2-results__option[aria-selected="true"] {
            display: none;
        }
    </style>
}

@section Scripts {
    <script src="~/lib/summernote/summernote-bs4.min.js"></script>
    <script src="~/lib/select2/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            $(".select2").select2({ width: '100%' });
            $('#Notify_Content').summernote({
                height: 300,
            });

            togglePlantSelection();
            $("input[name='Notify.IsAll']").change(function () {
                togglePlantSelection();
            })
        });

        function togglePlantSelection() {
            var value = $("input[name='Notify.IsAll']:checked").val();
            if (value == "true") {
                $("select[name='Notify.ToPlantIds']").parent().hide();
            } else {
                $("select[name='Notify.ToPlantIds']").parent().show();
            }
        }
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}


}
